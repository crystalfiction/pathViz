# pathViz

pathViz was born at the crossroads of data science, game development, and complex simulation algorithms. 

Its primary goal is to provide an accessible tool for analyzing dwarven path activity in Dwarf Fortress. The purpose is to improve overall understanding of dwarf activity within the context of a player's unique fort structure.
<br><br>

![main_screenshot](images/topDown_overlaid.png)
*A visual generated by pathViz, overlaid with the game screen, using the first year of a new fort as the subject*
<br><br>

Related resources include:
- [DFHack/devel/unit-path](https://github.com/DFHack/scripts/blob/master/devel/unit-path.lua) - a script located at `devel/unit-paths` in DFHack that visualizes the internal path of a selected dwarf, using the in-game GUI

## Setup

Dependencies:
- [Python 3.10.11](https://www.python.org/downloads/release/python-31011/)
- [pipenv 2023.12.1](https://pypi.org/project/pipenv/2023.12.1/)
- [pip](https://pypi.org/project/pip/)
- [DFHack](https://docs.dfhack.org/en/stable/docs/Installing.html#installing) - can be installed directly from Steam, if using DF premium
<br><br>

First, download the latest release of [pathViz](https://github.com/crystalfiction/pathViz/releases) to an easily accessible directory. *Make sure this directory is not within a cloud drive, or you will most likely encounter file permissions issues.*

Open terminal, move to the pathViz directory, then install its dependencies with `pipenv`
```bash
cd pathViz/
pipenv install
```

*This will take a few minutes.*

Once packages are done installing, activate the `pipenv` virtual environment
```bash
pipenv shell
```

Locate the `pathViz/.env` file and observe its variables
- `DATA_DIR`: the directory in which pathViz will log path data from the game
- `OUTPUT_DIR`: the directory in which pathViz will save generated visuals and statistics
- ***You do not need to change these, unless you would prefer alternative directory names***


Locate the `pathViz/logPaths.lua` file and open it, then locate the `filePrefix` towards the top. 

Change this to the system path of the directory specified at `DATA_DIR` in the `.env` file.
```lua
filePrefix = "C:\\<path_to_pathViz>\\pathViz\\data\\"

-- my path, using the default DATA_DIR="data/"
filePrefix = "C:\\Users\\rocke\\Documents\\pathViz\\data\\"
```

Finally, locate the `.hack/scripts/` folder in your `Dwarf Fortress` game directory. 

Move `logPaths.lua` to this folder, ensuring that it is _moved_ and _not copied_.

> ***IMPORTANT***
> If Dwarf Fortress is already running, you will need to go into the game, open the dfhack console with `ctrl-shift-p`, and run
> ```lua
> :lua require('script-manager').reload()
> ```
>
> This tells dfhack to reload all scripts in the `dfhack/scripts/` directory, ensuring that pathViz is recognized.



## Usage

### Start logging paths...
From the dfhack console (`ctrl-shift-p`) run
```lua
-- logs paths once per in-game week
-- the current day when enabled is the first snapshot
enable logPaths
```

### Load some data
```py
# make sure your terminal is still in the pipenv shell
python pathViz.py load
```

### Visualize some data
```py
python pathViz.py viz
```

Accepted arguments:
- `--g` - color each unique path by its path goal - Default: `False`
- `--c`: generate clusters for each snapshot using KMeans - Default: `False`
- `--heat`: generate a heatmap using the entire snapshot collection - Default: `False`
- `--limit`: limit the number of snapshots visualized - Default: `0`
- `--orient`: orient the limitation by "top," starting from the earliest snapshot, or "btm" starting from the latest - Default: `btm`

Examples
```py
# Simple example:
# limit to 3 snapshots: --limit 3,
# starting from the latest snapshot: --orient btm
python pathViz.py viz --limit 3 --orient btm

# Complex example:
# limit to 10 snapshots: --limit 10,
# starting from the earliest(top) snapshot: --orient top,
# including snapshot clusters: --c,
# grouped by goal: --g
python pathViz.py viz --limit 4 --orient top --c --g
```

### Clear your snapshots
```py
python pathViz.py clear
```

`clear` mode intentionally leaves path log files in the `DATA_DIR` persistent.
- This means you <u>_will need to manually relocate log files in the `DATA_DIR` if you do not want them considered when `load` is called_</u>
- Either back them up to a new folder, or simply delete them


## Screenshots

![newFort_y1](images/newFort_y1.png)
*A top-down perspective*

![newFort_y1_3d](images/newFort_y1_3d.png)
*A skewed, 3D perspective for scale*

![newFort_y1_zoomed](images/newFort_y1_zoomed.png)
*A zoomed-in, 3D perspective. We can see overall fort structure beginning to form.*

![newFort_y1_heat](images/newFort_y1_heat.png)
*A view demonstrating the heatmap functionality*